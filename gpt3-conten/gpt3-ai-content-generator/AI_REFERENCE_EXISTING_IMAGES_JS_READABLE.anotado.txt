[INFO] No se detectaron funciones en este archivo.

pt")Ye=".aipkit_cw_existing_col_caption .aipkit_cw_existing_truncate",Ot="caption";
else if(xe==="content")Ye=".aipkit_cw_existing_col_description .aipkit_cw_existing_truncate",Ot="description";
else return;
let qt=tt.querySelector(Ye);
if(!qt)return;
let kt=String(ke||"").trim();
qt.textContent=kt,kt?qt.setAttribute("title",kt):qt.removeAttribute("title");
let zt=K.find(Dt=>Number(Dt.id)===pe);
zt&&Ot&&(zt[Ot]=kt)}
,Ft=pe=>{
let xe=ee.get(pe);
xe&&(clearTimeout(xe),ee.delete(pe))}
,ht=(pe,xe,ke)=>{
let tt=f.querySelector(`#post-${
pe}
`);
if(!tt)return;
let Ye=tt.querySelector(".aipkit_cw_existing_status");
if(Ye){
if(Ft(pe),Ye.classList.remove("is-visible","is-error","is-success","is-processing","is-queued"),!ke){
Ye.textContent="";
return}
Ye.textContent=ke,Ye.classList.add("is-visible"),xe==="error"&&Ye.classList.add("is-error"),xe==="success"&&Ye.classList.add("is-success"),xe==="processing"&&Ye.classList.add("is-processing"),xe==="queued"&&Ye.classList.add("is-queued")}
}
,Le=pe=>ht(pe,"",""),Te=pe=>{
Ft(pe);
let xe=setTimeout(()=>Le(pe),_);
ee.set(pe,xe)}
,xt=pe=>{
if(j=pe,C&&Ue()){
let xe=C.dataset&&C.dataset.aipkitStopMode==="true",ke=le?pe:V.size===0||pe&&!xe;
C.disabled=ke,C.setAttribute("aria-disabled",ke?"true":"false"),ke?C.dataset.aipkitExistingDisabled="true":delete C.dataset.aipkitExistingDisabled}
if(S&&(S.disabled=pe),w){
let xe=rt();
w.disabled=pe||!!xe.postTypeOverride}
E&&(E.disabled=pe),I&&(I.disabled=pe),A&&(A.disabled=pe||B<=1),x&&(x.disabled=pe||B>=D),h&&(h.disabled=pe),M.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(xe=>{
xe.disabled=pe}
)}
,Kt=()=>{
let pe=rt();
w&&(pe.postTypeOverride?(w.value=pe.postTypeOverride,w.disabled=!0):(w.disabled=!1,w.value=J||"")),E&&pe.postTypeOverride==="attachment"&&(E.value="")}
,yt=pe=>{
!C||!Ue()||C.dataset&&C.dataset.aipkitStopMode==="true"||(typeof window.aipkit_setLoadingStateOpenAI=="function"?window.aipkit_setLoadingStateOpenAI(C,pe,"Update","Updating..."):C.disabled=pe)}
,ot=(pe,xe)=>{
let ke=`${
xe}
_update`,tt=pe&&pe[ke]||pe&&pe[xe]||"";
return String(tt||"").trim()}
,Li=pe=>{
let xe=document.getElementById("aipkit_content_writer_form");
if(!xe||typeof window.aipkit_getContentWriterFormConfig!="function")return{
error:"Content Writer form is not ready yet."}
;
let ke=window.aipkit_getContentWriterFormConfig(xe),tt=!!pe.useImageMetadataPrompts;
if(!l&&pe.postTypeOverride==="product")return{
error:"Optimize Products is a Pro feature. Upgrade to continue."}
;
let Ye=ut=>tt?ut==="title"?ke.generate_image_title==="1":ut==="keyword"?ke.generate_image_alt_text==="1":ut==="excerpt"?ke.generate_image_caption==="1":ut==="content"?ke.generate_image_description==="1":!1:ut==="meta"&&!pe.allowMeta||ut==="tags"&&!pe.allowTags?!1:ut==="title"?ke.generate_title!=="0":ut==="content"?ke.generate_content!=="0":ut==="meta"?ke.generate_meta_description==="1":ut==="keyword"?ke.generate_focus_keyword==="1":ut==="excerpt"?ke.generate_excerpt==="1":ut==="tags"?ke.generate_tags==="1":!1,Ot=tt?{
title:Ye("title")?ot(ke,"image_title_prompt"):"",content:Ye("content")?ot(ke,"image_description_prompt"):"",meta:"",keyword:Ye("keyword")?ot(ke,"image_alt_text_prompt"):"",excerpt:Ye("excerpt")?ot(ke,"image_caption_prompt"):"",tags:""}
:{
title:Ye("title")?ot(ke,"custom_title_prompt"):"",content:Ye("content")?ot(ke,"custom_content_prompt"):"",meta:Ye("meta")?ot(ke,"custom_meta_prompt"):"",keyword:Ye("keyword")?ot(ke,"custom_keyword_prompt"):"",excerpt:Ye("excerpt")?ot(ke,"custom_excerpt_prompt"):"",tags:Ye("tags")?ot(ke,"custom_tags_prompt"):""}
,qt=[],kt=ut=>pe.fieldLabels?.[ut]||r[ut]||ut;
if(Ye("title")&&!Ot.title&&qt.push(`${
kt("title")}
 prompt is required.`),Ye("content")&&!Ot.content&&qt.push(`${
kt("content")}
 prompt is required.`),Ye("meta")&&!Ot.meta&&qt.push(`${
kt("meta")}
 prompt is required.`),Ye("keyword")&&!Ot.keyword&&qt.push(`${
kt("keyword")}
 prompt is required.`),Ye("excerpt")&&!Ot.excerpt&&qt.push(`${
kt("excerpt")}
 prompt is required.`),Ye("tags")&&!Ot.tags&&qt.push(`${
kt("tags")}
 prompt is required.`),qt.length)return{
error:qt.join(" ")}
;
let zt=[],Dt=(ut,ft)=>ft.some(Ri=>ut.includes(Ri)),it=ut=>tt?t:pe.postTypeOverride==="product"&&s[ut]||i;
if(pe.fieldOrder.forEach(ut=>{
let ft=Ot[ut];
if(!ft)return;
let Ri=it(ut);
Dt(ft,Ri)||zt.push(`${
kt(ut)}
 prompt: add one of ${
Ri.join(", ")}
.`)}
),zt.length)return{
error:`${
tt?"Image optimization":pe.postTypeOverride==="product"?"Product update":"Update"}
 works best when prompts include source placeholders.

${
zt.join(`
`)}
`}
;
let Wt=String(ke.content_length||"medium"),Ae=a[Wt]||a.medium,Lt={
ai_provider:ke.ai_provider||"openai",ai_model:ke.ai_model||"",temperature:parseFloat(ke.ai_temperature||"1"),max_tokens:Ae,reasoning_effort:ke.reasoning_effort||"",generate_seo_slug:pe.allowSlug&&ke.generate_seo_slug||"0",enable_vector_store:ke.enable_vector_store||"0",vector_store_provider:ke.vector_store_provider||"openai",vector_store_top_k:ke.vector_store_top_k||"3",openai_vector_store_ids:ke.openai_vector_store_ids||[],pinecone_index_name:ke.pinecone_index_name||"",qdrant_collection_name:ke.qdrant_collection_name||"",vector_embedding_provider:ke.vector_embedding_provider||"",vector_embedding_model:ke.vector_embedding_model||""}
;
return{
prompts:Ot,baseConfig:Lt}
}
,yi=(pe,xe,ke)=>({
[pe]:{
prompt:xe}
,ai_provider:ke.ai_provider,ai_model:ke.ai_model,temperature:ke.temperature,max_tokens:ke.max_tokens,reasoning_effort:ke.reasoning_effort,enable_vector_store:ke.enable_vector_store,vector_store_provider:ke.vector_store_provider,vector_store_top_k:ke.vector_store_top_k,openai_vector_store_ids:ke.openai_vector_store_ids,pinecone_index_name:ke.pinecone_index_name,qdrant_collection_name:ke.qdrant_collection_name,vector_embedding_provider:ke.vector_embedding_provider,vector_embedding_model:ke.vector_embedding_model}
),Zt=async(pe=1)=>{
if(!R){
if(typeof window.aipkit_apiRequest!="function"){
console.error("Content Writer Existing: aipkit_apiRequest not found.");
return}
R=!0,qe("Loading posts...");
try{
let ke=rt().postTypeOverride||(w?w.value:""),tt=await window.aipkit_apiRequest("aipkit_content_writer_fetch_existing_posts",{
_ajax_nonce:$?$.value:"",post_type:ke,post_status:E?E.value:"",media_filter:y?y.value:"",search:I?I.value.trim():"",paged:pe,per_page:U}
);
nt(tt.posts||[],tt.pagination||{
}
)}
catch(xe){
console.error("Content Writer Existing: fetch failed",xe),qe("Unable to load posts. Please try again.")}
finally{
R=!1}
}
}
,Nt=()=>{
V.clear(),Se()}
;
M.addEventListener("change",pe=>{
let xe=pe.target;
if(!xe||!xe.classList.contains("aipkit_cw_existing_row_checkbox"))return;
let ke=Number(xe.value||0);
ke&&(xe.checked?V.add(ke):V.delete(ke),Se())}
),h&&h.addEventListener("change",()=>{
let pe=h.checked;
K.forEach(ke=>{
pe?V.add(Number(ke.id)):V.delete(Number(ke.id))}
),M.querySelectorAll(".aipkit_cw_existing_row_checkbox").forEach(ke=>{
ke.checked=pe}
),Se()}
),A&&A.addEventListener("click",()=>{
B>1&&Zt(B-1)}
),x&&x.addEventListener("click",()=>{
B<D&&Zt(B+1)}
),S&&S.addEventListener("click",()=>{
Nt(),Zt(1)}
),w&&w.addEventListener("change",()=>{
rt().postTypeOverride||(J=w.value),Nt(),Zt(1)}
),E&&E.addEventListener("change",()=>{
Nt(),Zt(1)}
),y&&y.addEventListener("change",()=>{
Nt(),Zt(1)}
),I&&I.addEventListener("input",()=>{
N&&clearTimeout(N),N=setTimeout(()=>{
Nt(),Zt(1)}
,300)}
);
let Jt=pe=>{
typeof window.aipkit_showAlertModal=="function"?window.aipkit_showAlertModal(pe,{
title:"Update existing"}
):alert(pe)}
,Pi=()=>{
let pe="Bulk image optimization is available on Pro. Select one image or upgrade.";
if(typeof window.aipkit_showAlertModal=="function"){
let xe=[];
p&&xe.push({
label:"Upgrade to Pro",href:p,className:"aipkit_btn aipkit_btn-primary"}
),xe.push({
label:"Close",className:"aipkit_btn aipkit_btn-secondary"}
),window.aipkit_showAlertModal(pe,{
title:"Optimize Images",actions:xe}
)}
else alert(pe)}
,Hi=()=>{
let pe="Optimize Products is a Pro feature.";
if(typeof window.aipkit_showAlertModal=="function"){
let xe=[];
p&&xe.push({
label:"Upgrade to Pro",href:p,className:"aipkit_btn aipkit_btn-primary"}
),xe.push({
label:"Close",className:"aipkit_btn aipkit_btn-secondary"}
),window.aipkit_showAlertModal(pe,{
title:"Optimize Products",bullets:d,actions:xe}
)}
else alert(pe)}
,ji=async(pe,xe,ke,tt,Ye)=>{
let Ot=`cw-existing-${
pe}
-${
Date.now()}
`,qt=!1;
if(L)return ht(pe,"","Stopped"),Te(pe),{
success:!1,stopped:!0}
;
for(let kt of Ye.fieldOrder){
let zt=xe[kt];
if(!zt)continue;
if(L)return ht(pe,"","Stopped"),Te(pe),{
success:!1,stopped:!0}
;
ht(pe,"processing",`Updating ${
Ye.fieldLabels[kt]||kt}
...`);
let Dt=yi(kt,zt,ke),it={
_ajax_nonce:tt,post_id:pe,field:kt,enhancements:JSON.stringify(Dt),conversation_uuid:Ot}
;
try{
let Wt=await window.aipkit_apiRequest("aipkit_bulk_process_single_field",it,{
timeout:18e4}
);
Wt&&Object.prototype.hasOwnProperty.call(Wt,"updated_value")&&(kt==="title"?ai(pe,Wt.updated_value):ti(pe,kt,Wt.updated_value)),qt=!0}
catch(Wt){
let Ae=Wt&&Wt.message||"Update failed. Please try again.";
return ht(pe,"error",Ae),{
success:!1}
}
}
if(L)return ht(pe,"","Stopped"),Te(pe),{
success:!1,stopped:!0}
;
if(ke.generate_seo_slug==="1"&&qt){
ht(pe,"processing","Updating URL...");
try{
await window.aipkit_apiRequest("aipkit_bulk_update_seo_slug",{
_ajax_nonce:tt,post_id:pe,action_type:"update_slug"}
,{
timeout:3e4}
)}
catch{
return ht(pe,"error","URL update failed."),{
success:!1}
}
}
return qt?(ht(pe,"success","Updated"),Te(pe),{
success:!0}
):(ht(pe,"error","No prompts selected."),{
success:!1}
)}
,ii=async()=>{
if(j||!Ue())return;
let pe=Array.from(V);
if(!pe.length)return;
if(!l&&Me()==="existing-content"){
let{
productIds:Ae,otherIds:Lt}
=de(pe);
if(Ae.length&&!Lt.length){
Hi(),Se();
return}
Ae.length&&Lt.length&&(Ae.forEach(ut=>{
ht(ut,"error","Skipped (Pro)"),Te(ut)}
),pe=Lt)}
if(!pe.length){
Se();
return}
if(!l&&Me()==="existing-images"&&pe.length>1){
Pi();
return}
if(typeof window.aipkit_apiRequest!="function"){
Jt("Update service is not available yet.");
return}
let xe=window.aipkit_post_enhancer?.nonce_generate_title;
if(!xe){
Jt("Update permission is missing. Please reload the page.");
return}
let ke=rt(),{
prompts:tt,baseConfig:Ye,error:Ot}
=Li(ke);
if(Ot){
!l&&ke.postTypeOverride==="product"?Hi():Jt(Ot);
return}
if(!ke.fieldOrder.some(Ae=>!!tt[Ae])){
Jt("No prompts selected for update.");
return}
L=!1,pe.forEach(Ae=>{
ht(Ae,"queued","Queued")}
);
let kt=0,zt=0,Dt=pe.length,it=null,Wt=()=>{
let Ae=[];
return Ae.push(`Updating ${
Dt}
 item${
Dt===1?"":"s"}
...`),kt&&Ae.push(`${
kt}
 done`),zt&&Ae.push(`${
zt}
 error${
zt===1?"":"s"}
`),Ae.join(" ")}
;
bt(Wt(),"info"),typeof window.aipkit_setContentWriterStopMode=="function"?window.aipkit_setContentWriterStopMode(!0):yt(!0),xt(!0);
for(let Ae=0;
Ae<pe.length;
Ae+=1){
let Lt=pe[Ae];
if(L){
it=Ae;
break}
let ut=await ji(Lt,tt,Ye,xe,ke);
if(ut&&ut.stopped){
L=!0,it=Ae+1;
break}
ut&&ut.success?kt+=1:zt+=1,bt(Wt(),"info")}
if(xt(!1),typeof window.aipkit_resetContentWriterButtons=="function"?window.aipkit_resetContentWriterButtons():yt(!1),L){
(it!==null?pe.slice(it):[]).forEach(ut=>{
ht(ut,"","Stopped"),Te(ut)}
);
let Lt=[`Update stopped: ${
kt}
 done`];
zt&&Lt.push(`${
zt}
 error${
zt===1?"":"s"}
`),bt(Lt.join(", ")+".","info")}
else zt?bt(`Update complete: ${
kt}
 done, ${
zt}
 error${
zt===1?"":"s"}
.`,"error"):bt(`Update complete: ${
kt}
 done.`,"success");
Ht(),Se()}
;
f.dataset.init="true",window.aipkit_cw_existing_handleFetch=Zt,window.aipkit_runContentWriterExistingUpdate=ii,window.aipkit_cw_isExistingUpdateActive=()=>j,window.aipkit_cw_requestExistingUpdateStop=wt,P&&!P.dataset.aipkitExistingListener&&(P.addEventListener("change",()=>{
y&&(y.value=""),Kt(),Nt()}
,!0),P.dataset.aipkitExistingListener="true"),Kt(),window.aipkit_cw_existing_pendingFetch&&(Zt(window.aipkit_cw_existing_pendingFetch),window.aipkit_cw_existing_pendingFetch=null)}
window.aipkit_initContentWriterExistingContent=m,window.aipkit_fetchContentWriterExistingPosts=u}
)();
(function(){
"use strict";
let g=[{
key:"custom_title_prompt",textareaId:"aipkit_cw_custom_title_prompt",updateInputId:"aipkit_cw_custom_title_prompt_update"}
,{
key:"custom_content_prompt",textareaId:"aipkit_cw_custom_content_prompt",updateInputId:"aipkit_cw_custom_content_prompt_update"}
,{
key:"custom_meta_prompt",textareaId:"aipkit_cw_c


